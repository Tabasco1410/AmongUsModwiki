<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Among Us Mod Wiki</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      margin: 0;
    }
    h1 {
      margin-bottom: 0;
    }
    p.description {
      margin-top: 5px;
      color: #555;
    }
    /* タブのスタイル */
    .tabs {
      margin-top: 20px;
      display: flex;
      border-bottom: 2px solid #ccc;
    }
    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border: 1px solid #ccc;
      border-bottom: none;
      background: #eee;
      margin-right: 5px;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
      user-select: none;
      transition: background 0.3s;
    }
    .tab.active {
      background: white;
      border-bottom: 2px solid white;
      font-weight: bold;
    }
    /* サブバーの役職リスト */
    .subbar {
      border: 1px solid #ccc;
      padding: 10px 15px;
      background: white;
      border-radius: 0 5px 5px 5px;
      margin-top: -1px;
    }
    .subbar ul {
      list-style: none;
      padding-left: 0;
      margin: 0;
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .subbar ul li a {
      text-decoration: none;
      color: #0366d6;
      padding: 5px 8px;
      border: 1px solid transparent;
      border-radius: 3px;
      transition: background-color 0.2s;
    }
    .subbar ul li a:hover {
      background-color: #d0e7ff;
      border-color: #0366d6;
    }
  </style>
</head>
<body>

  <h1>Among Us Mod Wiki</h1>
  <p class="description">ここではAmong UsのMod役職をカテゴリごとに詳しく紹介しています。</p>

  <div class="tabs" id="tabs">
    <!-- ここにカテゴリタブを動的生成 -->
  </div>

  <div class="subbar" id="subbar" style="display:none;">
    <ul id="subroles">
      <!-- ここにサブ役職リンクを動的生成 -->
    </ul>
  </div>

<script>
  // roles.jsonのパス
  const rolesJsonPath = './roles/roles.json';

  // 取得したデータを格納（再利用用）
  let rolesData = {};

  const tabsContainer = document.getElementById('tabs');
  const subbar = document.getElementById('subbar');
  const subrolesUl = document.getElementById('subroles');

  // JSONからカテゴリタブを作る関数
  function createTabs(data) {
    rolesData = data; // 保存

    Object.entries(data).forEach(([key, category]) => {
      const tab = document.createElement('div');
      tab.className = 'tab';
      tab.textContent = category.label;
      tab.dataset.key = key;
      tab.addEventListener('click', () => selectTab(key));
      tabsContainer.appendChild(tab);
    });
  }

  // タブ選択時の処理
  function selectTab(key) {
    // タブのactive切り替え
    [...tabsContainer.children].forEach(tab => {
      tab.classList.toggle('active', tab.dataset.key === key);
    });

    // サブ役職リストのクリア＆再生成
    subrolesUl.innerHTML = '';
    rolesData[key].roles.forEach(role => {
      const li = document.createElement('li');
      const a = document.createElement('a');
      // 役職ページへのリンク。URLパラメータでカテゴリと役職を渡す
      a.href = `roles/role.html?category=${key}&role=${role.key}`;
      a.textContent = role.label;
      li.appendChild(a);
      subrolesUl.appendChild(li);
    });

    subbar.style.display = 'block';
  }

  // ページ読み込み時にJSON読み込みと初期化
  fetch(rolesJsonPath)
    .then(res => {
      if (!res.ok) throw new Error('roles.jsonの読み込みに失敗しました');
      return res.json();
    })
    .then(data => {
      createTabs(data);
      // 最初のカテゴリを自動選択
      selectTab(Object.keys(data)[0]);
    })
    .catch(err => {
      document.body.innerHTML = `<p>データの読み込みに失敗しました。<br>${err}</p>`;
    });
</script>

</body>
</html>
